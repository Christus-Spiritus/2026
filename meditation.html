<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>M√©ditation du jour ‚Äì Parcours Christus</title>
  <style>
    :root{
      --bg:#0b1220; --text:#e8eefc; --muted:#a7b4d6;
      --accent:#7aa2ff; --line:rgba(255,255,255,.10);
    }
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:linear-gradient(180deg,#070b14,var(--bg)); color:var(--text); }
    .wrap{ max-width:900px; margin:0 auto; padding:18px; }
    .card{ background:rgba(17,26,46,.88); border:1px solid rgba(122,162,255,.15);
      border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.25); }
    h1{ font-size:20px; margin:0 0 6px; }
    .sub{ color:var(--muted); font-size:13px; margin:0 0 10px; line-height:1.5; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
    .btn{ background:rgba(122,162,255,.14); color:var(--text); border:1px solid rgba(122,162,255,.35);
      padding:10px 12px; border-radius:12px; cursor:pointer; text-decoration:none; display:inline-flex; align-items:center; gap:8px; }
    .btn.secondary{ background:rgba(255,255,255,.08); border:1px solid var(--line); }
    .btn[aria-disabled="true"]{ opacity:.45; pointer-events:none; }
    .hr{ height:1px; background:var(--line); margin:12px 0; }
    .content p{ margin:10px 0; line-height:1.65; }
    .pill{ font-size:12px; color:var(--muted); border:1px solid var(--line); padding:6px 10px; border-radius:999px; }
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="row">
      <div>
        <h1 id="title">M√©ditation du jour</h1>
        <p class="sub" id="dateLabel"></p>
      </div>
      <div class="pill" id="rangeLabel">Car√™me 2026</div>
    </div>

    <div class="row" style="margin-top:10px">
      <div style="display:flex; gap:10px; flex-wrap:wrap">
        <button class="btn secondary" id="prev">‚Üê Jour</button>
        <button class="btn secondary" id="next">Jour ‚Üí</button>
      </div>
      <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end">
        <a class="btn secondary" id="back" href="index.html">‚¨Ö Retour √† l‚Äôappli</a>
        <a class="btn" id="aelf" target="_blank" rel="noopener">üìñ √âvangile (AELF)</a>
      </div>
    </div>

    <div class="hr"></div>

    <div class="content" id="content"></div>
    <div class="sub" id="missing" style="display:none">M√©ditation non disponible pour cette date.</div>
  </div>
</div>

<script src="meditations-data.js"></script>
<script>
(() => {
  const START = new Date(2026, 1, 18); // 18 Feb 2026
  const END   = new Date(2026, 3, 5);  // 05 Apr 2026

  const $ = (id) => document.getElementById(id);

  function clamp(d){
    const x = new Date(d.getFullYear(), d.getMonth(), d.getDate());
    if(x < START) return new Date(START);
    if(x > END) return new Date(END);
    return x;
  }
  function toISO(d){
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    return `${yyyy}-${mm}-${dd}`;
  }
  function fromISO(iso){
    const m = /^(\d{4})-(\d{2})-(\d{2})$/.exec(iso||"");
    if(!m) return null;
    return new Date(parseInt(m[1],10), parseInt(m[2],10)-1, parseInt(m[3],10));
  }
  function addDays(d,n){
    const x = new Date(d.getFullYear(), d.getMonth(), d.getDate());
    x.setDate(x.getDate()+n);
    return x;
  }
  function formatFR(d){
    return new Intl.DateTimeFormat('fr-FR', { weekday:'long', year:'numeric', month:'long', day:'numeric' }).format(d);
  }
  function aelfUrl(iso){ return `https://www.aelf.org/${iso}/romain/messe`; }

  const params = new URLSearchParams(location.search);
  const isoParam = params.get("date");
  let current = clamp(fromISO(isoParam) || new Date());

  function render(){
    current = clamp(current);
    const iso = toISO(current);

    $("dateLabel").textContent = formatFR(current);
    $("aelf").href = aelfUrl(iso);
    $("back").href = "index.html"; // simple

    const data = (window.CHRISTUS_MEDITATIONS || {})[iso];
    if(data){
      $("title").textContent = "M√©ditation du jour";
      $("content").innerHTML = `<div class="pill" style="margin-bottom:10px">${data.title}</div>` + data.html;
      $("missing").style.display = "none";
    }else{
      $("content").innerHTML = "";
      $("missing").style.display = "block";
      $("missing").textContent = "M√©ditation non disponible pour " + iso + ".";
    }

    $("prev").setAttribute("aria-disabled", (current <= START) ? "true" : "false");
    $("next").setAttribute("aria-disabled", (current >= END) ? "true" : "false");

    // keep URL updated
    const url = new URL(location.href);
    url.searchParams.set("date", iso);
    history.replaceState({}, "", url);
  }

  $("prev").addEventListener("click", () => { if(current <= START) return; current = addDays(current,-1); render(); });
  $("next").addEventListener("click", () => { if(current >= END) return; current = addDays(current, 1); render(); });

  render();
})();
</script>
</body>
</html>
